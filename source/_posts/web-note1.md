title: 网站流量以及架构变迁
date: 2015-12-18 16:58:58
categories: Web #文章文类
tags: [Web]
---

对于很多公司不管是初创型还是其它类型的公司，伴随着公司发展以及业务的增长，流量都会随之增长，那么与此同时网站的架构也在随之改变 ,下面将会简单描述下各个阶级的各个特点。
<!--more-->


## 关键字: 小流量 初期
这个时候网站的特点是，业务相对来说比较简单，功能也相对来说比较少。
###### 架构特点：
- 单机系统
- 程序耦合
- CURD(核心思想都是CURD)

如果是用php开发的话一般都会考虑使用LAMP，然后找一个相对来说轻量级别的MVC框架。比如CI，TP之类的，php框架比较多根据你们的项目的具体情况选择一款合适的就可以了，无需在这上面过多的纠结。初级的程序员建议使用php编写的框架，因为在出问题的时候最起码可以进入源码调试下，也是个熟悉的过程，类似phalcon这样的C语言扩展框架就不推荐使用啦。
我们可将这种方式称之为`ALL IN ONE`，基本上是可以解决初期的问题了。

## 关键字: 跨越十万流量阶段 数据库 服务器 瓶颈问题
这个时候可能会遇到这样的一些情况，网站在正常使用的情况下是没有问题的，在面临一定峰值的时候就会出现宕机的情况，或者数据库直接挂了。记得以前做的一个教育学习网站，由于学生们要在上面完成作业，每到下午放学之后网站机会出现一系列问题。
这个时候，机器数量也从一台变成了多台，所以很自然的行程了分布式架构。或者在此之前我们可以先从我们的单台服务器入手去找一些可以优化的点，将单台服务器的性能发挥到最大。在这里我们就不详细说啦，我们先说说分布式的情况。

###### 架构特点：
![](http://7xokym.com1.z0.glb.clouddn.com/web_note1_博客架构图%20.jpg)
- 分布式系统
- 动静分离
- 读写分离(主从同步)

其实在单个数据库的角度我们可以先考虑对数据库进行分区或者索引之类的优化。
更高级的点就是对数据库进行水平或者垂直的拆分。



## 关键字: 高可用

###### 架构特点：

- 进一步垂直拆分
- 分层抽象
- 服务化

在做数据库读写分离的时候可能会遇到这样一个问题，**读写的延迟**，可能由于数据比较大的情况下，用户在写入一条数据进入数据库后，立马去读可能会有读不到的现象。这个时候我们可以考虑将我们的业务场景或者在数据的设计方面，进行更大的最小粒度化，简单的说就是将大数据量拆分成一个个小数据量。这样读写方面的延迟应该就会马上会得到缓解。

**站点的耦合**，可能你也会遇到这样的问题，网站在一开始开发的的时候可能随着业务的复杂度增加，每个模块之间的耦合或者模块内部的耦合就会增大许多。这个时候我们可以考虑适当的解耦。简单的做法可以将我们的业务进行拆分，对业务进行分层，然后采用面向服务的架构，一个模块就是一个服务，这样在稳定性以及耦合上面都会有所提高。

做过上面说的两点，那么站点耦合也得到了缓解，数据加载速度也提升了很多。

前面说到用数据库的读写分离是解决数据库动静数据分离的问题。然而对于web站点我们也可以进行动静分离。其中，我们可以静态资源使用了CDN服务，便于数据缓存和就近访问，访问速度得到很明显的提升。

其实后面还有很多的技术，其实核心的思想是不变的，基本就是软件工程里面常说的`高内聚，底耦合`，`服务化`等等一些列思想的延伸。我们可以想象下当我们遇到上亿数据的时候我们又改如何去处理。

## 总结
 我们可以看出，网站在不同的阶段遇到的问题不一样，而解决这些问题使用的技术也不一样，流量小的时候，我们可以使用简单的架构这个时候我觉得主要目的是`提高开发效率`(后面我会单独写篇文档讨论下如何去提高团队的开发效率)。随着流量变大，使用动静分离、读写分离、主从同步、垂直拆分、CDN、等方式不断地提升网站稳定性。面对更大的流量时，通过垂直拆分、服务化、等等，不断提升高可用。其实要想不同阶段之间可以更好地去过渡，那么我们得在开的时候时候就要有一定的前瞻性。你的团队必须需要这样一名有预见性的成员。
 


    
